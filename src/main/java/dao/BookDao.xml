<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.BookDao">
	<resultMap type="pojo.Book" id="resultBookMap">
		<id property="isbn" column="isbn"/>
		<result property="title" column="title"/>
		<result property="author" column="author"/>
		<result property="introduction" column="introduction"/>
		<result property="price" column="price"/>
		<result property="publisher" column="publisher"/>
		<result property="photo" column="photo"/>
		<result property="publishcationDate" column="publishcationDate"/>
		<association property="type" javaType="pojo.Type">
			<id property="id" column="id"/>
			<result property="typename" column="typename" ></result>		
		</association>
	</resultMap>
	<select id="queryAllBooks" resultMap="resultBookMap">
		select * from book,type where book.type_id=type.id
	</select>
	
	<!-- <select id="queryBookByTitleAndTypename"  resultType="pojo.Book" resultMap="resultBookMap">
	select * from book,type where typename=#{typename} 
	<if test="title != null and title !=''">
	and title like CONCAT('%',#{title},'%')
	</if>
	</select> -->
	
	<select id="queryBookByTitleAndTypename"  resultType="pojo.Book" resultMap="resultBookMap">
	select * from book,type where book.type_id=type.id
	<choose>
		<when test="title !=null and title !=''">
			and title like concat('%',#{title},'%')
		</when>
		<when test="typename !=null and typename !=''">
			and typename=#{typename}
		</when>
		<otherwise>
			and title is not null
		</otherwise>
	</choose>
	</select>
	
	<select id="queryBookByTitle" resultMap="resultBookMap">
		select * from book,type where isbn=#{isbn} and type.id=book.type_id
	</select>
	<delete id="deleteByIsbn" parameterType="String" >
	delete from book where isbn=#{isbn} 
	</delete>
	<insert id="addBook" parameterType="pojo.Book">
		insert into book values(#{isbn},#{title},#{type_id},#{author},#{introduction},#{price},#{publisher},#{photo},#{publishcationDate})
	</insert>		
	
	<update id="updateBook" parameterType="pojo.Book">
		update book set title=#{title},type_id=#{type_id},author=#{author},
		introduction=#{introduction},price=#{price},publisher=#{publisher},photo=#{photo},
		publishcationDate=#{publishcationDate} where isbn=#{isbn}
	</update>	
</mapper>